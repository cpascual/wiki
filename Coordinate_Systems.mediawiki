The MARS experience showed me that it is easy to get confused about the NeXus coordinate systems. I therefore suggest the following:

*Remove coordinates from all component DTD
*Make a documentation page describing our two coordinate systems:
**The simple polar_angle, distance etc system
**The NXgeometry system
*State that coordinate describing datasets can occur in any component group
*State that one system must be used throughout the whole definition

The last point should prohibit to have both NXgeometry and simple coordinates in one DTD. This can be
confusing. As NXgeometry is anyway intended to be used by the simulation community this should be OK.

==NeXus Coordinate System==

===Simple Coordinate System===
In this system the instrument is considered as a set of components through which the incident beam passes. The variable '''distance''' is assigned to each component and represents the beam flight path length between this component and the sample. A sign convention is used where -ve numbers represent components pre-sample and +ve numbers components post-sample. 

For angular information, the quantities ''polar_angle'' and ''azimuthal_angle'' are used and these quantities correspond exactly to the usual [http://en.wikipedia.org/wiki/Polar_coordinates polar coordinate] definitions i.e. the polar_angle is measured with respect to a ''z'' axis and the azimuthal_angle to an x axis. The direction of these local axes may be different for each component: ''z'' is the incident beam direction for the '''previous''' component and we then follow [http://mcstas.risoe.dk/ McStas] for ''x'' and ''y'' i.e. the ''x'' axis is perpendicular to the beam in the horizontal plane pointing left as seen from the source, and the y axis points upwards (see diagram below). The ''z'' axis thus represents the direction of the beam if it was un-deviated by the previous component, and so the polar_angle and azimuthal_angle for a component indicate how much the beam was bent/scattered by the previous component. In the case of an NXdetector element placed directly after an NXsample, the polar_angle would correspond to the ''Bragg angle'' or ''two theta''.

===NXgeometry based system===
 
This coordinate system is based on more fully on the [http://mcstas.risoe.dk/ McStas coordinate system]. The instrument is given a global, absolute coordinate system where the z axis points in the direction of the incident beam, the x axis is perpendicular to the beam in the horizontal plane pointing left as seen from the source, and the y axis points upwards. Each beamline component also has a local coordinate system, which is defined by the NXgeometry object. The local z direction for a component is taken as the incident beam direction, with x and y defined as before i.e. the x axis is perpendicular to the beam in the horizontal plane pointing left as seen from the source, and the y axis points upwards.

[[Image:Coordinates.png]]