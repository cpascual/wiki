== Introduction ==

This 'NeXus Archive Definition' proposal is similar to an 'Instrument Definition' but it describe the required information for neXus files that are meant to be centrally archived.

The Instrument Definitions should allow the creation of analysis software that are common among several instruments and/or facilities. With the Archive Definition, the aim is to allow shared data management tools, see below for more details. 

The Instrument Definitions and the Archive definition should not interfere with each other. To analyze the data of an instrument, you don't need to know the owner of the data or the name of the sample. To manage the data, you don't need the counts that have been measured by a specific detector.  

Before archiving and indexing the data, we need to define the granularity with which to do it. HDF 5 should allow a user to extract only one group from a file stored in a SRB system. I doubt that it would be very practical to catalogue the data so finely, at least not at a facility level. This definition assumes an indexing at the file level. 

A large part of the definition are optional parameters for nice to have information. For the moment, this definition represents only my understanding of the issue. Lot more discussion must occur to reach an agreement among NIAC members

== Multiple NXentry issue ==

The order of multiple NXentry is not recorded by the data format. Now, we only have a naming convention to record the creation/logical order. How well can we enforce such convention? It could be good to add a 'entry_num' metadata in the class for that. 

In the case of archiving and cataloguing, multiple NXentry make it difficult to extract metadata to characterize a file, (e.g. what if different samples?). In the case of high number of NXentry, it may be difficult to detect the varying part among all the constant information linked from a NXentry to another. We could define by convention that in files, which contains multiple NXentry, the first NXentry (named 'header' or 'entry 0'; or with 'entry_num = 0') would contain only constant information that does not need to be repeated or linked in all the NXentry. This NXentry would never contains NXdata, NXmonitor, NXevent_data, NXprocess, ... 


== Processed Data Archive ==

This definition is mostly written for raw data archive. Simulation and analysis results may use similar metadata but will probably use a smaller subset. 

One addition necessary for Archived analysis result is links to the input data. There is currently no scheme for such links in the neXus definition. I added an 'external_reference' class that can be replaced by an official one when defined. 


== DTD definition ==
<pre>
<?xml version="1.0" encoding="UTF-8"?>
<!--
URL:     http://www.nexus.anl.gov/
Editor:  L. Lerusse, CCLRC e-Science
$Id: ArchiveDefinition.xml,v 0.1 2006/02/10 $

Template of the Archive Definition.

-->
<NXentry name="entry 0"> <!-- See Multiple Entry comment above -->


   <!-- Identification metadata
		A unique identifier separate from the filename should be defined. 
		These parameters seems the more promising for this. 
		The control system should not allow creation of file with already 
		existing parameters.
    -->
    <title>{Extended title for file}?</title> 
    <experiment_identifier type="NX_CHAR">
        {unique identifier for the experiment, defined by the facility, possibly
        linked to the proposals}?
    </experiment_identifier>
    <run_number type="NX_INT">
        {Number of run or scan stored in this entry}?
    </run_number>
    <run_cycle type="NX_CHAR">
        {}?
    </run_cycle>   


    <!-- Data management metadata
    -->
    <release_date type="NX_CHAR"> 	   	 
    	{ Date of the public release of the data. (file_time + X years)}
    </release_date>
    <revision type="NX_CHAR">
    	{ Revision id of the file due to re-calibration, reprocessing, 
    	  new analysis, new instrument definition format, ... }
    </revision>
    <revision_comment type="NX_CHAR">
   	{Reason for the new revision. {e.g.: first revision, re-calibration,}?
    </revision_comment>

    <!-- Nexus format information
    	The definition tag is meant to contains the most precise instrument 
    	definition that apply to the data set. 
    	
    	The instrument definition is there to tell what analysis package 
    	should be able to analyze the data.
    -->
    <definition type="NX_CHAR" version="{DTD version number}" URL="{URL of DTD file}">
        {Name of entry DTD}
    </definition>
    <archive_definition type="NX_CHAR" version="{DTD version number}" URL="{URL of DTD file}">
        {Name of entry DTD}?
    </archive_definition>
    <local_definition type="NX_CHAR" version="{DTD version number}" URL="{URL of DTD file}">
        {Name of entry DTD}?
    </local_definition>   
    
    
    <!-- Timing metadata : 
    	start_time and end_time are mandatory
    	duration and/or collection_time would be nice to have
    -->	
    <start_time type="ISO8601">
        {Starting time of measurement}
    </start_time>
    <end_time type="ISO8601">
        {Ending time of measurement}
    </end_time>
    <duration type="NX_FLOAT" units="seconds">
        {Duration of measurement (end_time - start_time)}?
    </duration>
    <collection_time type="NX_FLOAT" units="seconds">
    	{Time transpired actually collecting data i.e. taking out time when 
    	collection was suspended due to e.g. temperature out of range}?
    </collection_time>
    
    
    <!-- Reliability metadata
    	Having the wrong information may be worst than having no information. 
    	The accuracy of the information provided by the experimenter may be  
    	difficult to determine. The minimum we can do is determine in which
    	condition the information was filled. 
    -->
    <info_reliability  type="NX_CHAR">
    	{information on the reliability/source of the information provided by
    	the experimenter.(e.g. : From proposal, updated at experiment time, ...}?
    </info_reliability>

    
    <!-- Experiment metadata
    	Description of the science related to the data.
    -->
    <discipline type="NX_CHAR">
    	{Keyword domain (e.g. chemistry, astronomy, ecology, … )}?
    </discipline>
 	<keyword type="NX_CHAR">
		{Keywords defined for this study.}?
	</keyword>
 	<keyword_source type="NX_CHAR">
		{A pointer to a reference work providing the definition of the 
		restricted vocabulary of which the keyword list is a subset.}?
	</keyword_source>
 	<subject type="NX_CHAR">  	
		{Subject categorizations for this study}?
	</subject>
 	<description_summary type="NX_CHAR">
		{Brief summary of the experiment, including key objectives}
	</description_summary>
 	<description type="NXNote">
		{Description of the full experiment (document in pdf, latex, …)}?
	</description>
 	<requirement type="NX_CHAR">
		{Special requirements of instrument}?
	</requirement>
 	<publications type="NX_CHAR">
		{List of publication related to the proposal}?
	</publications>
 	<publication_references type="NX_CHAR">
		{List of publication references related to the proposal.}?
	</publication_references>
 	<facility_access_type type="NX_CHAR">
		{Facility access type (normal, rapid access, program access …)}?
	</facility_access_type>
 	<grant_id  type="NX_CHAR" type="NX_CHAR"> 	  	
		{Identifier of the funding grant.}?
	</grant_id>
			
			
    <!-- Software metadata
    	May be useful to retrieve all data from a versioning case of problem 
    	related to a specific version of the acquisition/analysis program. 
    -->
    <program_name type="NX_CHAR" version="{Program version number}">
        {Name of program used to generate this file}?
    </program_name>

	<!-- User metadata
		At least one user with role 'principal_investigator' must be present to 
		define the owner of the data. 
		Other important roles are :
			'experimenter' to know who physically made the experiment,
			'local_contact' for any instrument configuration questions,
		Nice to have would be 'funding_agency', it may help to get money for 
		the next experiments. 
		
		I think that the users with role 'principal_investigator', 'proposer'  
		and 'experimenter' should be given access to the data. 
		To be define in the data right policy of the facility.
	-->		
    <NXuser name="user XX">1+
        <name type="NX_CHAR">
            {Name of user responsible for this entry}
        </name>
        <role type="NX_CHAR">
            {role of user responsible for this entry, comma separated list}
            {Suggested roles are "local_contact", "principal_investigator", 
            "proposer", "experimenter", "funding_agency"}
        </role>
        <affiliation type="NX_CHAR">
            {Affiliation of user}?
        </affiliation>
        <address type="NX_CHAR">
            {Address of user}?
        </address>
        <telephone_number type="NX_CHAR">
            {Telephone number of user}?
        </telephone_number>
        <fax_number type="NX_CHAR">
            {Fax number of user}?
        </fax_number>
        <email type="NX_CHAR">
            {Email of user}?
        </email>
        <facility_user_id type="NX_CHAR">
            {Facility based unique identifier for this person e.g. their 
            identification code on the facility address/contact database, 
            should allow owner identification by the archive system.}
        </facility_user_id>
        <affiliation_id type="NX_CHAR">
            {Affiliation unique identifier.}?
        </affiliation_id>
    </NXuser>

	<!-- Instruments metadata
		The instrument name should be descriptive as much as possible, 
		telling in which mode the instrument was working.
	-->
    <NXinstrument name="{Name of instrument}">
        <name type="NX_CHAR" short_name="{abbreviated name of instrument}">
            {Name of instrument}
        </name>
        <NXsource name="{Name of facility}">
            <name type="NX_CHAR">
                {Name of source}
            </name>
            <type type="NX_CHAR">
                "Spallation Neutron Source"|"Pulsed Reactor Neutron Source"| 
                "Reactor Neutron Source"|"Synchrotron X-ray Source"|
                "Pulsed Muon Source"|"Rotating Anode X-ray"|"Fixed Tube X-ray"
            </type>
            <probe type="NX_CHAR">
                neutron|x-ray|muon|electron
            </probe>
        </NXsource>
    </NXinstrument>

	<!-- Sample metadata
	-->
    <NXsample name="sample 1">
        <name type="NX_CHAR">
            {Descriptive name of sample}
        </name>
        <sample_id type="NX_CHAR">
            {Sample identifier}
        </sample_id>
        <chemical_formula type="NX_CHAR">
            {The chemical formula specified using CIF conventions.}{Abbreviated
            version of CIF standard: 
            1. Only recognized element symbols may be used.
            2. Each element symbol is followed by a 'count' number. A count 
            of '1' may be omitted. 
            3. A space or parenthesis must separate each cluster of (element 
            symbol + count). 
            4. Where a group of elements is enclosed in parentheses, the 
            multiplier for the group must follow the closing parentheses. That 
            is, all element and group multipliers are assumed to be printed as 
            subscripted numbers. 
            5. Unless the elements are ordered in a manner that corresponds to 
            their chemical structure, the order of the elements within any group 
            or moiety depends on whether or not carbon is present. If carbon is 
            present, the order should be: C, then H, then the other elements in 
            alphabetical order of their symbol. If carbon is not present, the 
            elements are listed purely in alphabetic order of their symbol. This 
            is the 'Hill' system used by Chemical Abstracts.}
        </chemical_formula>
		<description type="NX_CHAR">
            {Description of the sample}?
        </description>
        <short_title type="NX_CHAR">
            {20 character fixed length sample description for legends}?
        </short_title>        

        
        <!-- Sample Environment metadata
        	These parameters are to give an idea of the sample environment. 
      	
        	The data are stored in an NXlog (e.g temperature_log, ..) 
                those may be links from a sensor class located in the 
                NXinstrument class. 
        -->
        <temperature type="NXlog"> {Sample temperature. }? </temperature>
        <electric_field type="NXlog"> {Applied electric field}? </electric_field>
        <magnetic_field type="NXlog" > {Applied magnetic field}? </magnetic_field>
        <stress_field type="NXlog"> {External stress}? </stress_field>
        <pressure type="NXlog"> {Mininum of Applied pressure}?  </pressure>   
    </NXsample>
</NXentry>
</pre>

== Example ==

<pre>
<?xml version="1.0" encoding="UTF-8"?>
<!--
URL:     http://www.nexus.anl.gov/
Editor:  L. Lerusse, CCLRC e-Science
$Id: ArchiveDefinition.xml,v 0.1 2006/02/10 $

Template of the Archive Definition.

-->
<NXroot>
	<NXentry name="entry 0">
    	<title type="NX_CHAR"> Study of different table salts structure at room temperature. </title> 
    	<experiment_identifier type="NX_CHAR">	ISIS-TOSCA-20060306.001</experiment_identifier>
    	<run_number type="NX_INT"> 1 </run_number>
    	<run_cycle type="NX_CHAR"> winter 2006 </run_cycle>   
    	<release_date type="NX_CHAR"> 2007-03-06    </release_date>
    	<revision type="NX_CHAR"> 1.0   </revision>
   		<revision_comment type="NX_CHAR"> File Creation </revision_comment>
   		<definition type="NX_CHAR" version="0.1" URL="generic_definition.xml"> Generic Instrument Definition </definition>
    	<archive_definition type="NX_CHAR" version="1.0" URL="archive_definition.xml"> Archive Definition </archive_definition>
    	<local_definition type="NX_CHAR" version="1.5" URL="TOFRaw.xml"> Time Of Flight Raw definition. </local_definition>   
    	<start_time type="ISO8601"> 2006-03-06T15:20:05.45+00:00 </start_time>
    	<end_time type="ISO8601"> 2006-03-06T15:44:29.47+00:00 </end_time>
    	<duration type="NX_FLOAT" units="seconds"> 1464.02 </duration>
    	<collection_time type="NX_FLOAT" units="seconds"> 1005.12 </collection_time>
    	<info_reliability  type="NX_CHAR"> Updated at Experiment Time </info_reliability>
		<discipline type="NX_CHAR"> Physics  </discipline>
 		<keyword type="NX_CHAR"> salt, cooking, crystal</keyword>
 		<keyword_source type="NX_CHAR">	http://www.saltinstitute.org/ </keyword_source>
 		<subject type="NX_CHAR">  </subject>
 		<description_summary type="NX_CHAR"> This study will look for difference in the different table 
 			salt structure to determine which one is best suited to be put on chips. </description_summary>
 		<description type="NXNote"> "best_salt.pdf" </description>
 		<requirement type="NX_CHAR"> Humidity level should be minimal. </requirement>
 		<publications type="NX_CHAR"> L.L. & al, " The best salt for Margaritas shots", 
 			The Tequila Journal, june 2004. </publications>
 		<facility_access_type type="NX_CHAR"> Program access </facility_access_type>
 		<grant_id  type="NX_CHAR" type="NX_CHAR"> BE-2006.02361	</grant_id>
	    <program_name type="NX_CHAR" version="2.1.1"> TextWrangler </program_name>
    		
    	<NXuser name="user 01">
        	<name type="NX_CHAR"> Laurent Lerusse </name>
        	<role type="NX_CHAR"> principal_investigator, experimenter </role>
        	<affiliation type="NX_CHAR"> frite.be  </affiliation>
        	<address type="NX_CHAR">1 Grand Place, 1000 Bruxelles </address>
        	<telephone_number type="NX_CHAR">+32/2-12345678 </telephone_number>
        	<fax_number type="NX_CHAR">+32/2-12345690  </fax_number>
        	<email type="NX_CHAR">ll@frites.be  </email>
        	<facility_user_id type="NX_CHAR"> ll56 </facility_user_id>
        	<affiliation_id type="NX_CHAR"> BE-frite.be.001 </affiliation_id>
    	</NXuser>
    	<NXuser name="user 01">
        	<name type="NX_CHAR"> Damian Flannery </name>
        	<role type="NX_CHAR"> local_contact </role>
        	<affiliation type="NX_CHAR"> ISIS  </affiliation>
        	<address type="NX_CHAR">Didcot OX11 0QX </address>
        	<telephone_number type="NX_CHAR">+44/2-1235661234 </telephone_number>
        	<fax_number type="NX_CHAR">+44/1235775678  </fax_number>
        	<email type="NX_CHAR"> df@isis.uk  </email>
        	<facility_user_id type="NX_CHAR"> df07 </facility_user_id>
        	<affiliation_id type="NX_CHAR"> ISIS </affiliation_id>
    	</NXuser>
	    <NXinstrument name="ISIS - PRISMA">
        	<name type="NX_CHAR" short_name="PRISMA"> The inverse geometry crystal-analyser spectrometer and high resolution diffractometer - PRISMA </name>
        	<NXsource name="ISIS">
            	<name type="NX_CHAR"> ISIS TS1 / solid methane  </name>
            	<type type="NX_CHAR"> Spallation Neutron Source </type>
            	<probe type="NX_CHAR"> neutron </probe>
        	</NXsource>
    	</NXinstrument>
    	<NXsample name="sample 1">
     		<name type="NX_CHAR"> Himalayan Crystal Salts - sample 1 </name>
        	<sample_id type="NX_CHAR"> salt-himalaya.001 </sample_id>
        	<chemical_formula type="NX_CHAR"> Cl Na </chemical_formula>
			<description type="NX_CHAR"> The larger Himalayan salt crystals are hand-crushed to make this holistic,
				natural salt small enough to be used in a common saltshaker. This salt has all the natural 
				characteristics of the original crystals from which it comes and has a distinctive "alive" 
				taste that's naturally delicious. Slightly pink in color, it contains 84 minerals in a form that 
				can be easily assimilated and metabolized by the body. This salt is truly wholesome and delicious! </description>
        	<short_title type="NX_CHAR"> Himalayan Salts 1 </short_title>        
        	<min_temperature type="NX_FLOAT" param_type="free" units="Kelvin"> 280.85 </min_temperature>
        	<max_temperature type="NX_FLOAT" param_type="free" units="Kelvin"> 299.53 </max_temperature>    
                <min_pressure type="NX_FLOAT" param_type="free" UNIT="pascal"> 97.85 </min_pressure>
                <max_pressure type="NX_FLOAT" param_type="free" UNIT="pascal"> 98.24 </max_pressure>
    	</NXsample>
	</NXentry>
</NXroot>
</pre>
--[[User:L.lerusse|L.lerusse]] 09:04, 4 April 2006 (CDT)